<!-- templates/home.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/bootstrap-icons/bootstrap-icons.min.css" rel="stylesheet">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart -->
    <script src="https://cdn.jsdelivr.net/npm/moment"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>

    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/3.2.4/css/buttons.dataTables.css" rel="stylesheet">
    <!-- Optional JavaScript -->
    <script src="https://cdn.datatables.net/2.3.2/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.2.4/js/dataTables.buttons.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.2.4/js/buttons.dataTables.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.2.4/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.2.4/js/buttons.print.min.js"></script>

    <title>Phân tích thị trường - Trang chủ</title>
    <link rel="icon" href="static/images/favicon.png" type="image/png">
  </head>

  <body>
    <!-- Header -->
    <header>
        <nav class="navbar navbar-expand-lg bg-body-tertiary" data-bs-theme="light">
          <div class="container-fluid">
            <a class="navbar-brand" href="/"><img src="static/images/favicon.png" width="24" height="24"/> Bản tin thị trường</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Lãi suất / tỷ giá
                  </a>
                  <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li class="nav-item"><a class="nav-link" href="/markets/tpcp">Trái phiếu chính phủ (HNX)</a></li>
                    <li class="nav-item"><a class="nav-link" href="/markets/lshd">Lãi suất huy động</a></li>
                    <li class="nav-item"><a class="nav-link" href="/markets/omo">Thị trường mở (OMO)</a></li>
                    <li class="nav-item"><a class="nav-link" href="/markets/interbank">Liên ngân hàng</a></li>
                    <li class="nav-item"><a class="nav-link" href="/markets/sofr">Lãi suất SOFR</a></li>
                    <li class="nav-item"><a class="nav-link" href="/markets/tygia">Tỷ giá ngoại tệ</a></li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Dữ liệu vĩ mô
                  </a>
                  <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li class="nav-item"><a class="nav-link" href="/macros/calendar">Lịch chỉ số</a></li>
                    <li class="nav-item"><a class="nav-link" href="/macros/allnews">Tin vĩ mô</a></li>
                    <li class="nav-item"><a class="nav-link" href="/macros/monthly">Chỉ số vĩ mô-tháng</a></li>
                    <li class="nav-item"><a class="nav-link" href="/macros/quarterly">Chỉ số vĩ mô-quý</a></li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Tổng hợp
                  </a>
                  <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li class="nav-item"><a class="nav-link" href="/tonghop/omonet">Dòng tiền, tỷ giá, lãi suất</a></li>
                    <li class="nav-item"><a class="nav-link" href="/tonghop/macrotrend">Vĩ mô và tỷ giá</a></li>
                    <li class="nav-item"><a class="nav-link" href="/tonghop/nhandinh">Nhận định vĩ mô và thị trường</a></li>
                  </ul>
                </li>
                <li class="nav-item"><a class="nav-link" href="/users/about">Giới thiệu</a></li>
              </ul>
              <span class="navbar-text">
                <a class="btn btn-outline-primary btn-sm" href="/users/login"><i class="bi bi-person"></i> Đăng nhập</a>
              </span>
            </div>
          </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
        <li class="breadcrumb-item active" aria-current="dashboard">Dashboard</li>
      </ol>
    </nav>
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <select id="groupFilter">
            <option value="">Tất cả</option>
          </select>
          <table id="nhandinh" class="table table-hover"></table>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-6">
          <button type="button" class="btn btn-sm btn-outline-primary" name="btnRange" data-previous="30" data-next="7">1M</button>
          <button type="button" class="btn btn-sm btn-outline-primary" name="btnRange" data-previous="90" data-next="14">3M</button>
          <button type="button" class="btn btn-sm btn-outline-primary" name="btnRange" data-previous="180" data-next="30">6M</button>
          <button type="button" class="btn btn-sm btn-outline-primary" name="btnRange" data-previous="365" data-next="91">1Y</button>
          <input type="button" class="btn btn-sm btn-outline-info form-control-sm" id="minDate" value="2018-01-01" /> -
          <input type="button" class="btn btn-sm btn-outline-info form-control-sm" id="maxDate" value="2030-12-31" />
          <canvas id="myChart"></canvas>
          <canvas id="myChart1"></canvas>
        </div>
        <div class="col-lg-6">
          <button type="button" class="btn btn-sm btn-outline-primary" name="btnRange" data-previous="30" data-next="7">1M</button>
          <button type="button" class="btn btn-sm btn-outline-primary" name="btnRange" data-previous="90" data-next="14">3M</button>
          <button type="button" class="btn btn-sm btn-outline-primary" name="btnRange" data-previous="180" data-next="30">6M</button>
          <button type="button" class="btn btn-sm btn-outline-primary" name="btnRange" data-previous="365" data-next="91">1Y</button>
          <input type="button" class="btn btn-sm btn-outline-info form-control-sm" id="minDate" value="2018-01-01" /> -
          <input type="button" class="btn btn-sm btn-outline-info form-control-sm" id="maxDate" value="2030-12-31" />
          <canvas id="myChart5"></canvas>
          <canvas id="myChart2"></canvas>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <h5>Lãi suất, tỷ giá, OMO và DXY</h5>
          <i>Nguồn dữ liệu: sbv.gov.vn | hnx.vn | tradingeconomics.com | vietstock.vn | data.vietnambiz.vn </i>
          <table id="alldata" class="table table-hover"></table>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-6">
          <canvas id="myChart3"></canvas>
        </div>
        <div class="col-lg-6">
          <canvas id="myChart4"></canvas>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <h5>Lịch chỉ số vĩ mô <select id="nationFilter">
            <option value="">Tất cả</option>
          </select></h5>
          <table id="economics" class="table table-hover"></table>
        </div>
      </div>
    </div>
    <script>
      // 1. Create custom filter function
      $.fn.dataTable.ext.search.push(
        function(settings, data, dataIndex) {
          var min = $('#minDate').val();
          var max = $('#maxDate').val();
          var date = data[0]; // use column index for date (2nd col = index 1)
          if (!date) return false;
          // Parse date from string (assuming format YYYY-MM-DD)
          var d = new Date(date);
          if (
            (min === "" || new Date(min) <= d) &&
            (max === "" || new Date(max) >= d)
          ) {
            return true;
          }
          return false;
        }
      );
      function getChartData(table) {
        var vniborons = [];
        var vnibor3ms = [];
        var rate10ys = [];
        var nets = [];
        var rate3ms = [];
        var rate12ms = [];
        var usdvnds = [];
        var tygiasbvs = [];
        var sofrs = [];
        var vnisofrs = [];
        table.rows({ search: 'applied' }).every(function () {
          var data = this.data();
          if(data["VNIBOR-ON"]!=null)vniborons.push({x:data["date"],y:data["VNIBOR-ON"]});
          if(data["VNIBOR-3M"]!=null)vnibor3ms.push({x:data["date"],y:data["VNIBOR-3M"]});
          if(data["annualrate"]!=null)rate10ys.push({x:data["date"],y:data["annualrate"]});
          if(data["net"]!=null)nets.push({x:data["date"],y:data["net"]});
          if(data["1-3M"]!=null)rate3ms.push({x:data["date"],y:data["1-3M"]});
          if(data["12M"]!=null)rate12ms.push({x:data["date"],y:data["12M"]});
          if(data["USD/VND"]!=null)usdvnds.push({x:data["date"],y:data["USD/VND"]});
          if(data["tygiasbv"]!=null)tygiasbvs.push({x:data["date"],y:data["tygiasbv"]});
          if(data["sofr"]!=null)sofrs.push({x:data["date"],y:data["sofr"]});
          if(data["vnisofr"]!=null)vnisofrs.push({x:data["date"],y:data["vnisofr"]});
        });
        return { vniborons, vnibor3ms, rate10ys, nets, rate3ms, rate12ms, usdvnds, tygiasbvs, sofrs, vnisofrs };
      }
      $(document).ready(function() {
        $.get("static/data/calendarnews.json", function(data){
          var nationMaps = {
            "VN":"Việt Nam",
            "US":"Mỹ"
          }
          var tblCalendarnews = $("#economics").DataTable({
            data:data,
            columns: [
              {data: "date", title: "Ngày"},
              {data: "nation", title: "QG"},
              {data: "indicator", title: "Chỉ số"},
              {data: "actual", title: "Kỳ này"},
              {data: "forecast", title: "Dự báo"},
              {data: "previous", title: "Kỳ trước"},
            ],
            order:[[1,'desc'],[0,'desc']],
            pageLength: 10,
            pagingType: "simple",
            dom: 'rtp',
          });
          tblCalendarnews.column(1).data().unique().sort().each(function (d) {
            $('#nationFilter').append('<option value="' + d + '">' + nationMaps[d] + '</option>');
          });
          $('#nationFilter').on('change', function () {
            var val = $.fn.dataTable.util.escapeRegex($(this).val());
            tblCalendarnews.column(1).search(val ? '^' + val + '$' : '', true, false).draw();
          });
          $('#nationFilter').val("VN");
          $('#nationFilter').change();
        });
        $.get("static/data/nhandinh.json", function (data) {
          var groupMaps = {
            "market":"Thị trường liên ngân hàng",
            "forecast":"Dự báo tỷ giá",
            "vietnam":"Vĩ mô Việt Nam",
            "usa":"Vĩ mô Mỹ",
            "china":"Vĩ mô Trung Quốc",
            "europe":"Vĩ mô Châu Âu"
          }
          var table1 = $("#nhandinh").DataTable({
            data:data,
            columns: [
              {data: "date", title: "Ngày"},
              {data: "group", title: "Nhóm"},
              {data: "conclusion", title: "Nhận định"},
              {data: "translation", title: "Dịch"},
            ],
            columnDefs: [
              {
                render: (data, type, row) =>{
                  return "<h5>"+groupMaps[row["group"]]+"</h5>"+"<i>(Ngày tạo: "+row["date"]+")</i>"+"<p>" + row["conclusion"]+"</p>";
                },
                targets: 2
              },
              {visible: false, targets: [0,1,3]},
              { orderable: false, targets: [1, 2, 3] }
            ],
            order:[[0,'desc']],
            pageLength: 1,
            pagingType: "simple",
            dom: 'rtp'
          });
          table1.column(1).data().unique().sort().each(function (d) {
            $('#groupFilter').append('<option value="' + d + '">' + groupMaps[d] + '</option>');
          });
          $('#groupFilter').on('change', function () {
            var val = $.fn.dataTable.util.escapeRegex($(this).val());
            table1.column(1).search(val ? '^' + val + '$' : '', true, false).draw();
          });
          $('#groupFilter').val("market");
          $('#groupFilter').change();
        });
        $.get("static/data/macrotrend.json",function(data){
          var chartData3 = {
            usdvnds:[],
            tygiasbvs:[],
            fdis:[],
            tradebals:[],
            cpis:[],
            inflations:[],
            retailsales:[],
            fxreserves:[],
            pmis:[],
            exports:[],
            imports:[]
          };
          data.forEach(item => {
            if(item["USD/VND"]!=null)chartData3.usdvnds.push({x:item["date"],y:item["USD/VND"]});
            if(item["tygiasbv"]!=null)chartData3.tygiasbvs.push({x:item["date"],y:item["tygiasbv"]});
            if(item["fdi"]!=null)chartData3.fdis.push({x:item["date"],y:item["fdi"]});
            if(item["tradebal"]!=null)chartData3.tradebals.push({x:item["date"],y:item["tradebal"]});
            if(item["cpi"]!=null)chartData3.cpis.push({x:item["date"],y:item["cpi"]});
            if(item["inflation"]!=null)chartData3.inflations.push({x:item["date"],y:item["inflation"]});
            if(item["retailsale"]!=null)chartData3.retailsales.push({x:item["date"],y:item["retailsale"]});
            if(item["fxreserve"]!=null)chartData3.fxreserves.push({x:item["date"],y:item["fxreserve"]});
            if(item["pmi"]!=null)chartData3.pmis.push({x:item["date"],y:item["pmi"]});
            if(item["export"]!=null)chartData3.exports.push({x:item["date"],y:item["export"]});
            if(item["import"]!=null)chartData3.imports.push({x:item["date"],y:-item["import"]});
          });
          const ctx3 = document.getElementById('myChart3').getContext("2d");
          const ctx4 = document.getElementById('myChart4').getContext("2d");
          new Chart(ctx3, {
            data: {
              datasets: [{
                label: 'USD/VND',
                data: chartData3.usdvnds,
                type: 'line',
                yAxisID: 'y',
              },{
                label: 'FDI',
                data: chartData3.fdis,
                type: 'line',
                yAxisID: 'y1'
              },{
                label: 'Export',
                data: chartData3.exports,
                type: 'bar',
                yAxisID: 'y1'
              },{
                label: 'Import',
                data: chartData3.imports,
                type: 'bar',
                yAxisID: 'y1'
              },{
                label: 'Dự trữ ngoại hối',
                data: chartData3.fxreserves,
                type: 'line',
                yAxisID: 'y1'
              }]
            },
            options: {
              //responsive: true,
              plugins: {
                title: {
                  display: true,
                  text: "Tỷ giá USD/VND và FDI, Trade Balance, Dự trữ ngoại hối"
                },
                legend: {
                  display: true,
                  position: 'top'
                }
              },
              scales: {
                x: {
                  type: 'time',
                  time: {
                    unit: 'day', // Adjust unit as needed (e.g., 'month', 'hour')
                    displayFormats: {
                      day: 'MMM DD YYYY',
                      month: 'MMM YYYY',
                      hour: 'HH:mm'
                    }
                  },
                  ticks: {
                    maxRotation: 0,
                    minRotation: 0
                  },
                  tooltipFormat: 'MMM DD, YYYY',
                  title: {
                    display: false,
                    text: 'Ngày',
                  },
                },
                y: {
                  title: {
                    display: true,
                    text: 'đồng',
                  },
                  //beginAtZero: true,
                  position: 'left'
                },
                y1: {
                  title: {
                    display: true,
                    text: 'tỷ $',
                  },
                  position: 'right'
                }
              },
            }
          });

          new Chart(ctx4, {
            data: {
              datasets: [{
                label: 'Bán lẻ',
                data: chartData3.retailsales,
                type: 'line',
                yAxisID: 'y',
              },{
                label: 'Lạm phát',
                data: chartData3.inflations,
                type: 'line',
                yAxisID: 'y1'
              }]
            },
            options: {
              //responsive: true,
              plugins: {
                title: {
                  display: true,
                  text: "Doanh số Bán lẻ và Lạm phát"
                },
                legend: {
                  display: true,
                  position: 'top'
                }
              },
              scales: {
                x: {
                  type: 'time',
                  time: {
                    unit: 'day', // Adjust unit as needed (e.g., 'month', 'hour')
                    displayFormats: {
                      day: 'MMM DD YYYY',
                      month: 'MMM YYYY',
                      hour: 'HH:mm'
                    }
                  },
                  ticks: {
                    maxRotation: 0,
                    minRotation: 0
                  },
                  tooltipFormat: 'MMM DD, YYYY',
                  title: {
                    display: false,
                    text: 'Ngày',
                  },
                },
                y: {
                  title: {
                    display: true,
                    text: 'tỷ đồng',
                  },
                  //beginAtZero: true,
                  position: 'left'
                },
                y1: {
                  title: {
                    display: true,
                    text: '%/tháng',
                  },
                  position: 'right'
                }
              },
            }
          });
        });
        $.get("static/data/omo_cashflow.json", function(data) {
          var table = $('#alldata').DataTable( {
            data:data,
            columns: [
              {data: "date", title: "Ngày"},
              {data: "VNIBOR-ON", title: "VNIBOR-ON"},
              {data: "VNIBOR-3M", title: "VNIBOR-3M"},
              {data: "annualrate", title: "10Y"},
              {data: "net", title: "OMO-NET"},
              {data: "USD/VND", title: "USDVND"},
              {data: "tygiasbv", title: "SBV"},
              {data: "DX-YNYB", title: "DXY"},
              {data: "1-3M", title: "3M"},
              {data: "12M", title: "12M"},
              {data: "sofr", title: "SOFR"},
              {data: "vnisofr", title: "VNIBORON-SOFR"},
            ],
            columnDefs: [
              {
                render: (data, type, row) =>{
                  return data?parseFloat(data).toFixed(2):null;
                },
                targets: 3
              },
              { orderable: false, targets: [1,2,3,4,5,6,7,8,9] }
            ],
            order: [[0, 'asc']],
            pageLength: 10,
            //dom: 'lfrtip',
            dom: 'Brtp',
            layout: {
              topStart: {
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
              }
            }
          } );
          const ctx = document.getElementById('myChart').getContext("2d");
          const ctx1 = document.getElementById('myChart1').getContext("2d");
          const ctx2 = document.getElementById('myChart2').getContext("2d");
          const ctx3 = document.getElementById('myChart3').getContext("2d");
          const ctx5 = document.getElementById('myChart5').getContext("2d");
          var chartData = getChartData(table);
          var myChart = new Chart(ctx, {
            data: {
              datasets: [{
                label: 'OMO-NET',
                data: chartData.nets,
                type: 'bar',
                yAxisID: 'y',
              },{
                label: 'VNIBOR-ON',
                data: chartData.vniborons,
                type: 'line',
                yAxisID: 'y1'
              },{
                label: 'VNIBOR-3M',
                data: chartData.vnibor3ms,
                type: 'line',
                yAxisID: 'y1'
              },{
                label: '10Y TPCP',
                data: chartData.rate10ys,
                type: 'line',
                yAxisID: 'y1'
              },{
                label: '3M',
                data: chartData.rate3ms,
                type: 'line',
                yAxisID: 'y1'
              },{
                label: '12M',
                data: chartData.rate12ms,
                type: 'line',
                yAxisID: 'y1'
              }]
            },
            options: {
              //responsive: true,
              plugins: {
                title: {
                  display: true,
                  text: "Lãi suất thị trường và điều hành OMO của SBV"
                },
                legend: {
                  display: true,
                  position: 'top'
                }
              },
              scales: {
                x: {
                  type: 'time',
                  time: {
                    unit: 'day', // Adjust unit as needed (e.g., 'month', 'hour')
                    displayFormats: {
                      day: 'MMM DD YYYY',
                      month: 'MMM YYYY',
                      hour: 'HH:mm'
                    }
                  },
                  ticks: {
                    maxRotation: 0,
                    minRotation: 0
                  },
                  tooltipFormat: 'MMM DD, YYYY',
                  title: {
                    display: false,
                    text: 'Ngày',
                  },
                },
                y: {
                  title: {
                    display: true,
                    text: 'tỷ đồng',
                  },
                  beginAtZero: true,
                  position: 'left'
                },
                y1: {
                  title: {
                    display: true,
                    text: 'tỷ lệ (%)',
                  },
                  position: 'right'
                }
              },
            }
          });

          var myChart1 = new Chart(ctx1, {
            data: {
              datasets: [{
                label: 'USD/VND',
                data: chartData.usdvnds,
                type: 'line',
                yAxisID: 'y',
              },{
                label: 'VNIBOR-ON',
                data: chartData.vniborons,
                type: 'line',
                yAxisID: 'y1'
              },{
                label: 'SOFR',
                data: chartData.sofrs,
                type: 'line',
                yAxisID: 'y1'
              },{
                label: 'Chênh lệch',
                data: chartData.vnisofrs,
                type: 'bar',
                yAxisID: 'y1'
              }]
            },
            options: {
              //responsive: true,
              plugins: {
                title: {
                  display: true,
                  text: "Tỷ giá USD/VND và Chênh lệch lãi suất VNIBOR-SOFR"
                },
                legend: {
                  display: true,
                  position: 'top'
                }
              },
              scales: {
                x: {
                  type: 'time',
                  time: {
                    unit: 'day', // Adjust unit as needed (e.g., 'month', 'hour')
                    displayFormats: {
                      day: 'MMM DD YYYY',
                      month: 'MMM YYYY',
                      hour: 'HH:mm'
                    }
                  },
                  ticks: {
                    maxRotation: 0,
                    minRotation: 0
                  },
                  tooltipFormat: 'MMM DD, YYYY',
                  title: {
                    display: false,
                    text: 'Ngày',
                  },
                },
                y: {
                  title: {
                    display: true,
                    text: 'đồng',
                  },
                  //beginAtZero: true,
                  position: 'left'
                },
                y1: {
                  title: {
                    display: true,
                    text: 'tỷ lệ (%)',
                  },
                  position: 'right'
                }
              },
            }
          });

          var myChart5 = new Chart(ctx5, {
            data: {
              datasets: [{
                label: 'OMO-NET',
                data: chartData.nets,
                type: 'bar',
                yAxisID: 'y',
              },{
                label: 'Tỷ giá trung tâm',
                data: chartData.tygiasbvs,
                type: 'line',
                yAxisID: 'y1'
              }]
            },
            options: {
              //responsive: true,
              plugins: {
                title: {
                  display: true,
                  text: "Điều hành tỷ giá trung tâm và OMO của SBV"
                },
                legend: {
                  display: true,
                  position: 'top'
                }
              },
              scales: {
                x: {
                  type: 'time',
                  time: {
                    unit: 'day', // Adjust unit as needed (e.g., 'month', 'hour')
                    displayFormats: {
                      day: 'MMM DD YYYY',
                      month: 'MMM YYYY',
                      hour: 'HH:mm'
                    }
                  },
                  ticks: {
                    maxRotation: 0,
                    minRotation: 0
                  },
                  tooltipFormat: 'MMM DD, YYYY',
                  title: {
                    display: false,
                    text: 'Ngày',
                  },
                },
                y: {
                  title: {
                    display: true,
                    text: 'tỷ đồng',
                  },
                  beginAtZero: true,
                  position: 'left'
                },
                y1: {
                  title: {
                    display: true,
                    text: 'đồng',
                  },
                  position: 'right'
                }
              },
            }
          });
          
          var myChart2 = new Chart(ctx2, {
            data: {
              datasets: [{
                label: 'OMO-NET',
                data: chartData.nets,
                type: 'bar',
                yAxisID: 'y',
              },{
                label: 'USDVND',
                data: chartData.usdvnds,
                type: 'line',
                yAxisID: 'y1'
              }]
            },
            options: {
              //responsive: true,
              plugins: {
                title: {
                  display: true,
                  text: "Tỷ giá USD/VND và Bơm ròng OMO-NET"
                },
                legend: {
                  display: true,
                  position: 'top'
                }
              },
              scales: {
                x: {
                  type: 'time',
                  time: {
                    unit: 'day', // Adjust unit as needed (e.g., 'month', 'hour')
                    displayFormats: {
                      day: 'MMM DD YYYY',
                      month: 'MMM YYYY',
                      hour: 'HH:mm'
                    }
                  },
                  ticks: {
                    maxRotation: 0,
                    minRotation: 0
                  },
                  tooltipFormat: 'MMM DD, YYYY',
                  title: {
                    display: false,
                    text: 'Ngày',
                  },
                },
                y: {
                  title: {
                    display: true,
                    text: 'tỷ đồng',
                  },
                  beginAtZero: true,
                  position: 'left'
                },
                y1: {
                  title: {
                    display: true,
                    text: 'đồng',
                  },
                  position: 'right'
                }
              },
            }
          });

          table.on('draw', function () {
            var newData = getChartData(table);
            myChart.data.datasets[0].data = newData.nets;
            myChart.data.datasets[1].data = newData.vniborons;
            myChart.data.datasets[2].data = newData.vnibor3ms;
            myChart.data.datasets[3].data = newData.rate10ys;
            myChart.data.datasets[4].data = newData.rate3ms;
            myChart.data.datasets[5].data = newData.rate12ms;
            myChart.update();
            myChart1.data.datasets[0].data = newData.usdvnds;
            myChart1.data.datasets[1].data = newData.vniborons;
            myChart1.data.datasets[2].data = newData.sofrs;
            myChart1.data.datasets[3].data = newData.vnisofrs;
            myChart1.update();
            myChart2.data.datasets[0].data = newData.nets;
            myChart2.data.datasets[1].data = newData.usdvnds;
            myChart2.update();
            myChart5.data.datasets[0].data = newData.nets;
            myChart5.data.datasets[1].data = newData.tygiasbvs;
            myChart5.update();
          });
          $('button[name="btnRange"]').click(function(){
            $('button[name="btnRange"]').css("font-weight","normal");
            $('button[name="btnRange"]').css("text-decoration","none");
            $('button[data-previous="'+$(this).data('previous')+'"]').css("font-weight","bold");
            $('button[data-previous="'+$(this).data('previous')+'"]').css("text-decoration","underline");
            const toDate = new Date();
            const fromDate = new Date();
            fromDate.setDate(fromDate.getDate()-parseInt($(this).data("previous")));
            toDate.setDate(toDate.getDate()+parseInt($(this).data("next")));
            $("#minDate").val(fromDate.toISOString().split("T")[0]);
            $("#maxDate").val(toDate.toISOString().split("T")[0]);
            table.draw();
          });
          $('button[data-previous="30"]').click();
        });
      });
    </script>

    </main>

    <!-- Footer -->
    <footer class="text-center">
        <p>&copy; 2025 Agribank - Trung tâm Quản lý rủi ro phi tín dụng - Phòng QLRR Thị trường</p>
    </footer>
  </body>
</html>